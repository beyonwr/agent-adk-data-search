%% ============================================================
%% Agent ADK Data Search - System Architecture Diagram
%% Framework: Google Agent Development Kit (ADK)
%% Purpose: ìì—°ì–´ ì§ˆì˜ â†’ SQL ìƒì„± â†’ DB ì¡°íšŒ ìë™í™” ì‹œìŠ¤í…œ
%% ============================================================

%% ============================================================
%% 1. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡° (High-Level Overview)
%% ============================================================
%%
%% ì‚¬ìš©ìê°€ ìì—°ì–´ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ë©´, ë©€í‹° ì—ì´ì „íŠ¸ íŒŒì´í”„ë¼ì¸ì´
%% ì¹¼ëŸ¼ ì¶”ì¶œ â†’ ì¹¼ëŸ¼ í‘œì¤€í™” â†’ SQL ìƒì„±/ì‹¤í–‰ì˜ 3ë‹¨ê³„ë¥¼ ê±°ì³
%% PostgreSQL DBì—ì„œ ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
%% ============================================================

graph TB
    subgraph USER["ğŸ‘¤ ì‚¬ìš©ì"]
        UserInput["ìì—°ì–´ ì§ˆì˜<br/>(í•œêµ­ì–´)"]
        UserFile["ì²¨ë¶€ íŒŒì¼<br/>(ì´ë¯¸ì§€/ì—‘ì…€)"]
    end

    subgraph SYSTEM["Agent ADK Data Search System"]

        subgraph ROOT["Root Agent<br/>(agents/agent.py)"]
            RA["root_agent<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ìš”ì²­ ë¶„ì„ ë° ìœ„ì„<br/>- ê²°ê³¼ í†µí•© ë° ì‘ë‹µ<br/>- í•œêµ­ì–´ ì¶œë ¥ ê°•ì œ"]
        end

        subgraph DSA["Data Search Agent<br/>(sub_agents/data_search_agent/data_search_agent.py)"]
            SEQ["data_search_agent<br/>SequentialAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>3ê°œ Loopë¥¼ ìˆœì°¨ ì‹¤í–‰"]

            subgraph LOOP1["Loop 1: Column Extraction<br/>(LoopAgent, max 3íšŒ)"]
                CE["column_name_extractor<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì‚¬ìš©ì ì§ˆì˜ì—ì„œ<br/>  ì¹¼ëŸ¼ëª… í‚¤ì›Œë“œ ì¶”ì¶œ<br/>- output: ExtractedColumnNames"]
                CR["column_name_reviewer<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì¶”ì¶œ ì™„ì „ì„± ê²€ì¦<br/>- ëˆ„ë½ ì¹¼ëŸ¼ ì§€ì <br/>- ì™„ë£Œ ì‹œ exit tool í˜¸ì¶œ"]
                CE -->|"ì¶”ì¶œ ê²°ê³¼<br/>bga_column_names state"| CR
                CR -->|"í”¼ë“œë°±<br/>(ëˆ„ë½ ì‹œ ì¬ì¶”ì¶œ)"| CE
            end

            subgraph LOOP2["Loop 2: Column Standardization<br/>(LoopAgent â€” ë¯¸êµ¬í˜„)"]
                CS["column_name_standardizer<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì¶”ì¶œëœ ì¹¼ëŸ¼ëª…ì„<br/>  DB í‘œì¤€ ì¹¼ëŸ¼ëª…ìœ¼ë¡œ ë³€í™˜"]
                CSR["column_name_standard_reviewer<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- í‘œì¤€í™” ê²°ê³¼ ê²€ì¦"]
                CS --> CSR
                CSR -->|"í”¼ë“œë°±"| CS
            end

            subgraph LOOP3["Loop 3: SQL Generation<br/>(LoopAgent, max 3íšŒ)"]
                SG["sql_generator<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì¹¼ëŸ¼ëª… + ì°¸ì¡°ë¬¸ì„œ ê¸°ë°˜<br/>  SELECT SQL ìƒì„±<br/>- AS ì ˆ ìµœì†Œí™”"]
                SR["sql_reviewer<br/>LlmAgent<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- SQL ì •í™•ì„± ê²€ì¦<br/>- ì¡°ê±´ ì¹¼ëŸ¼ SELECT í¬í•¨ í™•ì¸<br/>- í†µê³¼ ì‹œ DB ì¿¼ë¦¬ ì‹¤í–‰"]
                SG -->|"ìƒì„±ëœ SQL"| SR
                SR -->|"ìˆ˜ì • ìš”ì²­<br/>(ì˜¤ë¥˜ ì‹œ ì¬ìƒì„±)"| SG
            end

            SEQ --> LOOP1
            LOOP1 -->|"ì¶”ì¶œëœ ì¹¼ëŸ¼ëª…<br/>bga_column_names"| LOOP2
            LOOP2 -->|"í‘œì¤€í™”ëœ ì¹¼ëŸ¼ëª…"| LOOP3
        end
    end

    subgraph EXTERNAL["ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        LLM["LLM ì„œë²„<br/>(LiteLlm)<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>ROOT_AGENT_MODEL<br/>ROOT_AGENT_API_BASE"]
        PG["PostgreSQL DB<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>BGA ë°ì´í„° ì €ì¥ì†Œ<br/>(psycopg async pool)"]
        CHROMA["ChromaDB<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰<br/>ì¹¼ëŸ¼ ì„¤ëª… ë¬¸ì„œ ì €ì¥"]
        EMB["BGE-M3-KO<br/>Embedding ì„œë²„<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>í…ìŠ¤íŠ¸ â†’ ë²¡í„° ë³€í™˜"]
    end

    UserInput --> RA
    UserFile --> RA
    RA -->|"transfer_to_agent"| SEQ
    SR -->|"query_bga_database()"| PG
    SG -.->|"before_model_callback<br/>get_sql_query_references"| CHROMA
    CHROMA -.->|"ìœ ì‚¬ ë¬¸ì„œ ì¡°íšŒ"| EMB
    RA <-->|"LLM í˜¸ì¶œ"| LLM
    CE <-->|"LLM í˜¸ì¶œ"| LLM
    CR <-->|"LLM í˜¸ì¶œ"| LLM
    SG <-->|"LLM í˜¸ì¶œ"| LLM
    SR <-->|"LLM í˜¸ì¶œ"| LLM
    PG -->|"ì¿¼ë¦¬ ê²°ê³¼<br/>(CSV Artifact)"| UserInput

    style LOOP2 stroke-dasharray: 5 5, stroke: #ff6b6b
    style ROOT fill:#e8f4fd,stroke:#2196F3
    style DSA fill:#fff8e1,stroke:#FFC107
    style LOOP1 fill:#e8f5e9,stroke:#4CAF50
    style LOOP2 fill:#ffebee,stroke:#ff6b6b
    style LOOP3 fill:#f3e5f5,stroke:#9C27B0
    style EXTERNAL fill:#fce4ec,stroke:#E91E63


%% ============================================================
%% 2. ë°ì´í„° íë¦„ (Data Flow)
%% ============================================================

---

flowchart LR
    subgraph INPUT["ì…ë ¥"]
        Q["ì‚¬ìš©ì ìì—°ì–´ ì§ˆì˜"]
        IMG["ì²¨ë¶€ ì´ë¯¸ì§€ (ì„ íƒ)"]
    end

    subgraph EXTRACT["1ë‹¨ê³„: ì¹¼ëŸ¼ ì¶”ì¶œ"]
        E1["í‚¤ì›Œë“œ ë¶„ì„"]
        E2["ì¹¼ëŸ¼ëª… ì¶”ì¶œ<br/>(requested_entity,<br/>requested_columns,<br/>conditional_columns,<br/>inferred_columns)"]
        E3["ì¶”ì¶œ ê²€ì¦"]
    end

    subgraph STANDARD["2ë‹¨ê³„: ì¹¼ëŸ¼ í‘œì¤€í™”"]
        S1["ì¶”ì¶œëœ ì¹¼ëŸ¼ëª…"]
        S2["DB í‘œì¤€ ì¹¼ëŸ¼ëª…<br/>ë§¤í•‘"]
    end

    subgraph SQLGEN["3ë‹¨ê³„: SQL ìƒì„±"]
        G1["ChromaDBì—ì„œ<br/>ì°¸ì¡° ë¬¸ì„œ ê²€ìƒ‰"]
        G2["SQL SELECT<br/>ë¬¸ ìƒì„±"]
        G3["SQL ê²€ì¦"]
        G4["PostgreSQL<br/>ì¿¼ë¦¬ ì‹¤í–‰"]
    end

    subgraph OUTPUT["ì¶œë ¥"]
        O1["CSV Artifact<br/>ì €ì¥"]
        O2["Markdown í…Œì´ë¸”<br/>ì‚¬ìš©ì ì‘ë‹µ"]
    end

    Q --> E1 --> E2 --> E3
    E3 -->|"bga_column_names<br/>state"| S1 --> S2
    S2 --> G1 --> G2 --> G3 --> G4
    G4 --> O1 --> O2
    IMG -.->|"before_agent_callback<br/>ImgArtifact ì €ì¥"| O1

    style EXTRACT fill:#e8f5e9,stroke:#4CAF50
    style STANDARD fill:#fff3e0,stroke:#FF9800
    style SQLGEN fill:#f3e5f5,stroke:#9C27B0
    style OUTPUT fill:#e3f2fd,stroke:#2196F3


%% ============================================================
%% 3. ì½œë°± ì‹œìŠ¤í…œ (Callback Architecture)
%% ============================================================

---

flowchart TB
    subgraph CALLBACKS["ì½œë°± ì‹œìŠ¤í…œ (agents/utils/file_utils.py)"]
        direction TB

        subgraph BEFORE_AGENT["before_agent_callback"]
            BA["save_imgfile_artifact<br/>_before_agent_callback()"]
            BA_DESC["ì‚¬ìš©ì ì…ë ¥ ì´ë¯¸ì§€ë¥¼<br/>ImgArtifactë¡œ ì €ì¥"]
            BA --> BA_DESC
        end

        subgraph BEFORE_MODEL["before_model_callback"]
            BM1["remove_non_text_part<br/>_from_llmrequest<br/>_before_model_callback()"]
            BM1_DESC["LLM ìš”ì²­ì—ì„œ inline_data ì œê±°<br/>â†’ í† í° ì‚¬ìš©ëŸ‰ ìµœì í™”"]
            BM1 --> BM1_DESC

            BM2["get_sql_query_references<br/>_before_model_callback()"]
            BM2_DESC["ChromaDBì—ì„œ ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰<br/>â†’ LLM ì»¨í…ìŠ¤íŠ¸ì— ì£¼ì… (RAG)"]
            BM2 --> BM2_DESC
        end

        subgraph AFTER_TOOL["after_tool_callback"]
            AT["save_file_artifact<br/>_after_tool_callback()"]
            AT_DESC["ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ë¥¼ Artifactë¡œ ì €ì¥<br/>- CSV: ì¿¼ë¦¬ ê²°ê³¼ í…Œì´ë¸”<br/>- PNG: ì°¨íŠ¸ ì´ë¯¸ì§€<br/>- XLSX: í†µê³„ ë¦¬í¬íŠ¸"]
            AT --> AT_DESC
        end
    end

    TRIGGER1["Root Agent<br/>í˜¸ì¶œ ì‹œ"] -->|"ì´ë¯¸ì§€ ì…ë ¥ ê°ì§€"| BEFORE_AGENT
    TRIGGER2["LLM ìš”ì²­<br/>ì „ì†¡ ì§ì „"] -->|"ëª¨ë“  ì—ì´ì „íŠ¸"| BM1
    TRIGGER2B["SQL Generator<br/>LLM ìš”ì²­ ì „"] -->|"sql_generatorë§Œ"| BM2
    TRIGGER3["Tool ì‹¤í–‰<br/>ì™„ë£Œ ì§í›„"] -->|"sql_reviewerë§Œ"| AFTER_TOOL

    style BEFORE_AGENT fill:#fff9c4,stroke:#F9A825
    style BEFORE_MODEL fill:#e1f5fe,stroke:#0288D1
    style AFTER_TOOL fill:#f1f8e9,stroke:#689F38


%% ============================================================
%% 4. ìƒíƒœ ê´€ë¦¬ (State Management)
%% ============================================================

---

flowchart TB
    subgraph STATE_SYSTEM["ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ"]
        subgraph CONSTANTS["ìƒìˆ˜ (constants/constants.py)"]
            C1["ARTIFACT_STATES = 'artifact_states'"]
            C2["BGA_COLUMN_NAMES_STATES = 'bga_column_names'"]
            C3["BGA_COLUMN_NAMES_REF_DOCS_STATES = 'bga_column_names_reference_docs'"]
            C4["NUM_OF_DISPLAYED_DATA = 5"]
        end

        subgraph STATE_MGR["State Manager (utils/state_manager_utils.py)"]
            SM1["_initialize_state()"]
            SM2["add_artifact_to_state()"]
            SM3["get_state()"]
            SM4["delete_state()"]
            SM5["get_all_states()"]
            SM6["clear_all_states()"]
        end

        subgraph MODELS["ë°ì´í„° ëª¨ë¸ (custom_types/data_state.py)"]
            M1["BaseArtifact<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>type, filename,<br/>mime_type,<br/>function_call_id,<br/>user_query"]
            M2["ImgArtifact<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>type='img'<br/>img_size: Tuple"]
            M3["TabularArtifact<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>type='table'<br/>sql_query: str<br/>data_length: int"]
            M4["AppState<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>artifacts: List[BaseArtifact]"]

            M1 --> M2
            M1 --> M3
            M4 -->|"contains"| M1
        end

        subgraph TOOL_RESP["Tool ì‘ë‹µ ëª¨ë¸ (custom_types/tool_response.py)"]
            TR1["ToolResponseData<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>type: image | markdown_table<br/>      | csv_table | excel_table<br/>content: str | list | dict"]
            TR2["ToolResponse<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>status: success | error<br/>message: str<br/>data: ToolResponseData"]
        end
    end

    SM2 -->|"ìƒì„±"| M2
    SM2 -->|"ìƒì„±"| M3
    SM1 -->|"ì´ˆê¸°í™”"| M4
    SM3 -->|"ë°˜í™˜"| M4

    style CONSTANTS fill:#fff3e0,stroke:#E65100
    style STATE_MGR fill:#e8eaf6,stroke:#283593
    style MODELS fill:#e0f2f1,stroke:#00695C
    style TOOL_RESP fill:#fce4ec,stroke:#880E4F


%% ============================================================
%% 5. ë„êµ¬ ì²´ê³„ (Tools Architecture)
%% ============================================================

---

flowchart TB
    subgraph TOOLS["ë„êµ¬ ì²´ê³„ (sub_agents/data_search_agent/tools/)"]
        subgraph EXTRACT_TOOLS["ì¹¼ëŸ¼ ì¶”ì¶œ ë„êµ¬"]
            T1["exit_column_extraction_loop()<br/>(column_name_extraction_tools.py)<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì¹¼ëŸ¼ ì¶”ì¶œ ì™„ë£Œ ì‹ í˜¸<br/>- escalate=True ì„¤ì •<br/>- ì¹¼ëŸ¼ 0ê°œ ì‹œ ì—ëŸ¬ ë°˜í™˜"]
        end

        subgraph SQL_TOOLS["SQL ë„êµ¬"]
            T2["query_bga_database()<br/>(sql_generator_tools.py)<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- PostgreSQL ë¹„ë™ê¸° ì¿¼ë¦¬ ì‹¤í–‰<br/>- ê²°ê³¼ë¥¼ CSV ToolResponseë¡œ ë°˜í™˜<br/>- escalate=Trueë¡œ ë£¨í”„ íƒˆì¶œ"]
            T3["get_sql_query_references<br/>_before_model_callback()<br/>(sql_generator_tools.py)<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>- ì‚¬ìš©ì ì§ˆì˜ë¡œ ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰<br/>- LLM ì»¨í…ìŠ¤íŠ¸ì— ì°¸ì¡° ë¬¸ì„œ ì£¼ì…"]
        end

        subgraph VECTOR_TOOLS["ë²¡í„° ê²€ìƒ‰ ìœ í‹¸ (bga_column_name_processor.py)"]
            T4["_get_embedding()<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>BGE-M3-KO ëª¨ë¸ë¡œ<br/>í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„±"]
            T5["get_sim_search()<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>ChromaDB ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰<br/>n_results ê°œì˜ ìœ ì‚¬ ë¬¸ì„œ ë°˜í™˜"]
            T5 --> T4
        end

        subgraph REF_DATA["ì°¸ì¡° ë°ì´í„°"]
            T6["layer_info_column_description.json<br/>â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„<br/>DB ì¹¼ëŸ¼ ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ<br/>(table, column_name, description,<br/> data_type, example)"]
        end
    end

    CR2["column_name_reviewer"] -->|"í˜¸ì¶œ"| T1
    SR2["sql_reviewer"] -->|"í˜¸ì¶œ"| T2
    T3 -->|"í˜¸ì¶œ"| T5
    T5 -->|"HTTP POST"| EMB2["BGE-M3-KO<br/>Embedding ì„œë²„"]
    T5 -->|"query"| CHROMA2["ChromaDB"]
    T2 -->|"async query"| PG2["PostgreSQL"]

    style EXTRACT_TOOLS fill:#e8f5e9,stroke:#4CAF50
    style SQL_TOOLS fill:#f3e5f5,stroke:#9C27B0
    style VECTOR_TOOLS fill:#e3f2fd,stroke:#2196F3
    style REF_DATA fill:#fff8e1,stroke:#FFC107


%% ============================================================
%% 6. ëª¨ë“ˆ ì˜ì¡´ì„± (Module Dependencies)
%% ============================================================

---

graph TD
    subgraph DEPS["ëª¨ë“ˆ ì˜ì¡´ì„± ê·¸ë˜í”„"]
        agent_py["agents/agent.py<br/>(Root Agent ì •ì˜)"]
        dsa_py["data_search_agent.py<br/>(SequentialAgent ì •ì˜)"]
        prompt_yaml_root["agents/prompt.yaml<br/>(Root í”„ë¡¬í”„íŠ¸)"]
        prompt_yaml_dsa["data_search_agent/prompt.yaml<br/>(Sub-agent í”„ë¡¬í”„íŠ¸)"]

        prompt_utils["utils/prompt_utils.py<br/>(YAML í”„ë¡¬í”„íŠ¸ ë¡œë”)"]
        file_utils["utils/file_utils.py<br/>(Artifact ì½œë°± ê´€ë¦¬)"]
        state_mgr["utils/state_manager_utils.py<br/>(ìƒíƒœ ê´€ë¦¬)"]
        db_utils["utils/database_utils.py<br/>(DB Pool â€” ë¯¸êµ¬í˜„)"]

        constants["constants/constants.py<br/>(ìƒìˆ˜ ì •ì˜)"]

        data_state["custom_types/data_state.py<br/>(AppState, Artifact ëª¨ë¸)"]
        tool_response["custom_types/tool_response.py<br/>(ToolResponse ëª¨ë¸)"]

        col_extract["tools/column_name_extraction_tools.py"]
        sql_tools["tools/sql_generator_tools.py"]
        bga_proc["tools/bga_column_name_processor.py"]
        col_json["tools/layer_info_column_description.json"]

        agent_py --> prompt_utils
        agent_py --> file_utils
        agent_py --> dsa_py
        agent_py --> prompt_yaml_root

        dsa_py --> prompt_utils
        dsa_py --> file_utils
        dsa_py --> col_extract
        dsa_py --> sql_tools
        dsa_py --> prompt_yaml_dsa
        dsa_py --> constants

        prompt_utils --> prompt_yaml_root
        prompt_utils --> prompt_yaml_dsa

        file_utils --> state_mgr
        file_utils --> data_state
        file_utils --> tool_response
        file_utils --> constants

        state_mgr --> data_state
        state_mgr --> constants

        sql_tools --> bga_proc
        sql_tools --> db_utils
        sql_tools --> tool_response

        col_extract --> constants
        col_extract --> tool_response

        bga_proc -.->|"HTTP"| EMB3["BGE-M3-KO ì„œë²„"]
        bga_proc -.->|"HTTP"| CHROMA3["ChromaDB ì„œë²„"]
        sql_tools -.->|"async"| PG3["PostgreSQL DB"]
    end

    style agent_py fill:#e8f4fd,stroke:#2196F3,stroke-width:2px
    style dsa_py fill:#fff8e1,stroke:#FFC107,stroke-width:2px
    style db_utils fill:#ffebee,stroke:#ff6b6b,stroke-dasharray: 5 5
    style constants fill:#f5f5f5,stroke:#9E9E9E
    style data_state fill:#e0f2f1,stroke:#00695C
    style tool_response fill:#fce4ec,stroke:#880E4F


%% ============================================================
%% 7. ë””ë ‰í† ë¦¬ êµ¬ì¡° (File Structure)
%% ============================================================

---

graph TD
    subgraph STRUCTURE["í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°"]
        ROOT_DIR["ğŸ“ agent-adk-data-search/"]

        ROOT_DIR --> README["ğŸ“„ README.md"]
        ROOT_DIR --> GITIGNORE["ğŸ“„ .gitignore"]
        ROOT_DIR --> PYVER["ğŸ“„ .python-version (3.12)"]
        ROOT_DIR --> ARCH["ğŸ“„ architecture.mmd"]

        ROOT_DIR --> AGENTS["ğŸ“ agents/"]
        AGENTS --> AGENT_PY["ğŸ“„ agent.py â€” Root Agent"]
        AGENTS --> PROMPT_ROOT["ğŸ“„ prompt.yaml â€” Root í”„ë¡¬í”„íŠ¸"]

        AGENTS --> CONST_DIR["ğŸ“ constants/"]
        CONST_DIR --> CONST_INIT["ğŸ“„ __init__.py"]
        CONST_DIR --> CONST_PY["ğŸ“„ constants.py"]

        AGENTS --> TYPES_DIR["ğŸ“ custom_types/"]
        TYPES_DIR --> TYPES_INIT["ğŸ“„ __init__.py"]
        TYPES_DIR --> DATA_STATE["ğŸ“„ data_state.py"]
        TYPES_DIR --> TOOL_RESP_PY["ğŸ“„ tool_response.py"]

        AGENTS --> UTILS_DIR["ğŸ“ utils/"]
        UTILS_DIR --> UTILS_INIT["ğŸ“„ __init__.py"]
        UTILS_DIR --> FILE_UTILS["ğŸ“„ file_utils.py"]
        UTILS_DIR --> PROMPT_UTILS["ğŸ“„ prompt_utils.py"]
        UTILS_DIR --> STATE_MGR_PY["ğŸ“„ state_manager_utils.py"]
        UTILS_DIR --> DB_UTILS["ğŸ“„ database_utils.py âš ï¸"]
        UTILS_DIR --> LOG_UTILS["ğŸ“„ log_utils.py âš ï¸"]
        UTILS_DIR --> MODEL_COMM["ğŸ“„ model_communication_utils.py âš ï¸"]

        AGENTS --> SUB_DIR["ğŸ“ sub_agents/"]
        SUB_DIR --> SUB_INIT["ğŸ“„ __init__.py"]
        SUB_DIR --> DSA_DIR["ğŸ“ data_search_agent/"]
        DSA_DIR --> DSA_INIT["ğŸ“„ __init__.py"]
        DSA_DIR --> DSA_PY["ğŸ“„ data_search_agent.py"]
        DSA_DIR --> PROMPT_DSA["ğŸ“„ prompt.yaml"]
        DSA_DIR --> DSA_SUB["ğŸ“ sub_agents/ âš ï¸"]
        DSA_DIR --> TOOLS_DIR["ğŸ“ tools/"]
        TOOLS_DIR --> COL_TOOLS["ğŸ“„ column_name_extraction_tools.py"]
        TOOLS_DIR --> SQL_TOOLS_PY["ğŸ“„ sql_generator_tools.py"]
        TOOLS_DIR --> BGA_PROC_PY["ğŸ“„ bga_column_name_processor.py"]
        TOOLS_DIR --> COL_JSON["ğŸ“„ layer_info_column_description.json"]
    end

    style DB_UTILS fill:#ffebee,stroke:#ff6b6b
    style LOG_UTILS fill:#ffebee,stroke:#ff6b6b
    style MODEL_COMM fill:#ffebee,stroke:#ff6b6b
    style DSA_SUB fill:#ffebee,stroke:#ff6b6b
